# YOLOv9 Federated Learning Framework

ä¸€å€‹åŸºæ–¼ YOLOv9 çš„è¯é‚¦å­¸ç¿’ç³»çµ±ï¼Œä½¿ç”¨ Slurm å¢é›†ç’°å¢ƒé€²è¡Œåˆ†æ•£å¼è¨“ç·´å’Œèšåˆã€‚

## ğŸ“‹ ç›®éŒ„

- [ç³»çµ±æ¦‚è¿°](#ç³»çµ±æ¦‚è¿°)
- [ç’°å¢ƒéœ€æ±‚](#ç’°å¢ƒéœ€æ±‚)
- [å®‰è£è¨­å®š](#å®‰è£è¨­å®š)
- [å¿«é€Ÿé–‹å§‹](#å¿«é€Ÿé–‹å§‹)
- [è©³ç´°ä½¿ç”¨èªªæ˜](#è©³ç´°ä½¿ç”¨èªªæ˜)
- [ç›®éŒ„çµæ§‹](#ç›®éŒ„çµæ§‹)
- [è…³æœ¬èªªæ˜](#è…³æœ¬èªªæ˜)
- [å¯¦é©—ç®¡ç†](#å¯¦é©—ç®¡ç†)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)

## ğŸ¯ ç³»çµ±æ¦‚è¿°


### è¯é‚¦å­¸ç¿’æµç¨‹

```
Round 1: yolov9-c.pt â†’ [Client1, Client2, Client3, Client4] â†’ w_s_r1.pt
Round 2: w_s_r1.pt  â†’ [Client1, Client2, Client3, Client4] â†’ w_s_r2.pt
Round 3: w_s_r2.pt  â†’ [Client1, Client2, Client3, Client4] â†’ w_s_r3.pt
...
```

## ğŸ› ï¸ ç’°å¢ƒéœ€æ±‚

### å¿…è¦æ¢ä»¶
- **ä½œæ¥­ç³»çµ±**ï¼šLinux 
- **ä½œæ¥­èª¿åº¦å™¨**ï¼šSlurm Workload Manager
- **å®¹å™¨å¼•æ“**ï¼šSingularity
- **Python**ï¼šâ‰¥ 3.8
- **GPU**ï¼šNVIDIA GPU (æ”¯æ´ CUDA)

### è»Ÿé«”æº–å‚™

- PyTorch â‰¥ 2.1.0
- Wandb (å¯¦é©—è¿½è¹¤)
- YOLOv9 ç›¸é—œä¾è³´ (åƒè¦‹ `yolov9/requirements.txt`)
TODO : éœ€è£œå…… yolov9 ä¸‹è¼‰ç¶²å€

## ğŸ“¦ å®‰è£è¨­å®š

### 1. ä¸‹è¼‰å°ˆæ¡ˆ
```bash
git clone <repository-url>
cd fl_yolo
```

### 2. æº–å‚™ Singularity æ˜ åƒæª”
ç¢ºä¿ `yolo9t2_ngc2306_20241226.sif` æ˜ åƒæª”å­˜åœ¨æ–¼å°ˆæ¡ˆæ ¹ç›®éŒ„ï¼š
```bash
ls -la yolo9t2_ngc2306_20241226.sif
```
TODO : éœ€è£œå…… singualrity å®¹å™¨ ä¸‹è¼‰ç¶²å€

### 3. æº–å‚™è³‡æ–™é›†
å°‡è³‡æ–™é›†æ”¾ç½®æ–¼å°æ‡‰ç›®éŒ„ï¼š
```
datasets/
â”œâ”€â”€ kitti/
â”‚   â”œâ”€â”€ images/
â”‚   â”‚   â”œâ”€â”€ train/
â”‚   â”‚   â””â”€â”€ val/
â”‚   â””â”€â”€ labels/
â”‚       â”œâ”€â”€ train/
â”‚       â””â”€â”€ val/
â””â”€â”€ ...

data/
â”œâ”€â”€ kitti.yaml
â””â”€â”€ ...
```
TODO : éœ€è£œå……èªªæ˜ dataset ä¸‹è¼‰ç¶²å€


### 4. åˆå§‹æ¬Šé‡
ç¢ºä¿ YOLOv9 é è¨“ç·´æ¬Šé‡å­˜åœ¨ï¼š
```bash
ls -la yolov9-c.pt
```
TODO : éœ€è£œå…… yolov9-c.pt ä¸‹è¼‰ç¶²å€

## ğŸš€ å¿«é€Ÿé–‹å§‹

### è‡ªå‹•æ¨¡å¼ (æ¨è–¦)
åŸ·è¡Œå®Œæ•´çš„è¯é‚¦å­¸ç¿’å¯¦é©—ï¼š
```bash
cd src
./orchestrate.sh kitti 4 2
```

### æ‰‹å‹•æ¨¡å¼
ç”Ÿæˆæ¨™æº–æ“ä½œç¨‹åº (SOP)ï¼š
```bash
cd src
./orchestrate.sh kitti 4 2 --manual > sop.sh
```
ç„¶å¾ŒæŒ‰ç…§ `sop.sh` ä¸­çš„å‘½ä»¤é€æ­¥åŸ·è¡Œã€‚

## ğŸ“š è©³ç´°ä½¿ç”¨èªªæ˜

### åŸºæœ¬èªæ³•
```bash
./orchestrate.sh <DATASET_NAME> <CLIENT_NUM> <TOTAL_ROUNDS>
./orchestrate.sh <DATASET_NAME> <CLIENT_NUM> <TOTAL_ROUNDS> [--manual] [--val]
```

### åƒæ•¸èªªæ˜
- `DATASET_NAME`: è³‡æ–™é›†åç¨± (ä¾‹å¦‚ï¼škitti, cityscapes)
- `CLIENT_NUM`: å®¢æˆ¶ç«¯æ•¸é‡ (ä¾‹å¦‚ï¼š4)
- `TOTAL_ROUNDS`: è¯é‚¦å­¸ç¿’è¼ªæ¬¡ (ä¾‹å¦‚ï¼š2, 5)
- `--manual`: å¯é¸ï¼Œç”Ÿæˆæ‰‹å‹•åŸ·è¡Œçš„ SOP
- `--val`: å¯é¸ï¼ŒåŒ…å«æ¨¡å‹é©—è­‰æ­¥é©Ÿ

### ç¯„ä¾‹
```bash
# 4å€‹å®¢æˆ¶ç«¯ï¼Œé€²è¡Œ5è¼ªè¯é‚¦å­¸ç¿’
./orchestrate.sh kitti 4 5

# åŒ…å«é©—è­‰çš„è¯é‚¦å­¸ç¿’å¯¦é©—
./orchestrate.sh kitti 4 2 --val

# 8å€‹å®¢æˆ¶ç«¯ï¼Œé€²è¡Œ3è¼ªè¯é‚¦å­¸ç¿’ï¼Œç”Ÿæˆæ‰‹å‹•åŸ·è¡Œæ–‡æª”ï¼ˆå«é©—è­‰ï¼‰
./orchestrate.sh cityscapes 8 3 --manual --val > cityscapes_sop.sh
```

## ğŸ“Š æ¨¡å‹é©—è­‰åŠŸèƒ½

### é©—è­‰åŠŸèƒ½æ¦‚è¿°
æœ¬ç³»çµ±æä¾›å®Œæ•´çš„è¯é‚¦å­¸ç¿’æ¨¡å‹é©—è­‰åŠŸèƒ½ï¼Œæ”¯æ´ï¼š
- âœ… **å¤šæ¨¡å‹æ¯”è¼ƒ**ï¼šè‡ªå‹•æ¯”è¼ƒåŸºç·šæ¨¡å‹èˆ‡å„è¼ªæ¬¡èšåˆæ¨¡å‹
- âœ… **è©³ç´°æŒ‡æ¨™åˆ†æ**ï¼šmAP@0.5ã€mAP@0.5:0.95ã€ç²¾åº¦ã€å¬å›ç‡
- âœ… **æ¯é¡åˆ¥åˆ†æ**ï¼šé¡¯ç¤ºå„é¡åˆ¥çš„ AP å€¼å’Œæ”¹å–„æƒ…æ³
- âœ… **è³‡æ–™é›†åˆ†æ**ï¼šæª¢æ¸¬è³‡æ–™é›†é¡åˆ¥åˆ†å¸ƒå’Œç¼ºå¤±é¡åˆ¥
- âœ… **æ•ˆèƒ½æ¯”è¼ƒ**ï¼šè¨ˆç®—å„è¼ªæ¬¡ç›¸å°æ–¼åŸºç·šçš„æ”¹å–„å¹…åº¦

### å•Ÿç”¨é©—è­‰
åœ¨ orchestrate.sh å‘½ä»¤ä¸­åŠ å…¥ `--val` åƒæ•¸ï¼š

```bash
# è‡ªå‹•æ¨¡å¼ï¼ˆå«é©—è­‰ï¼‰
./orchestrate.sh kitti 4 2 --val

# æ‰‹å‹•æ¨¡å¼ï¼ˆå«é©—è­‰ï¼‰
./orchestrate.sh kitti 4 2 --manual --val > sop.sh
```

### æ‰‹å‹•åŸ·è¡Œé©—è­‰
æ‚¨ä¹Ÿå¯ä»¥ç¨ç«‹åŸ·è¡Œé©—è­‰è…³æœ¬ï¼š

```bash
# é©—è­‰æŒ‡å®šå¯¦é©—çš„æ‰€æœ‰æ¨¡å‹
python3 src/validate_federated_model.py \
    --experiment-dir experiments/9_kitti_4C_2R_202508051443 \
    --data-config data/kitti.yaml

# è‡ªè¨‚åŸºç·šæ¨¡å‹å’Œè¼¸å‡ºç›®éŒ„
python3 src/validate_federated_model.py \
    --experiment-dir experiments/9_kitti_4C_2R_202508051443 \
    --data-config data/cityscapes.yaml \
    --baseline-model custom_baseline.pt \
    --output-dir custom_validation_results
```

### é©—è­‰çµæœèªªæ˜
é©—è­‰å®Œæˆå¾Œæœƒåœ¨ `${EXP_DIR}/validation/` ç›®éŒ„ç”¢ç”Ÿï¼š

1. **validation_summary.txt** - äººé¡å¯è®€çš„æ‘˜è¦å ±å‘Š
   - æ•´é«”æŒ‡æ¨™æ¯”è¼ƒè¡¨
   - æ¯é¡åˆ¥ mAP åˆ†æè¡¨
   - æ•ˆèƒ½æ”¹å–„åˆ†æ
   - è³‡æ–™é›†é¡åˆ¥åˆ†å¸ƒåˆ†æ

2. **model_comparison.json** - è©³ç´°çš„ JSON æ ¼å¼çµæœ
   - å®Œæ•´çš„æŒ‡æ¨™æ•¸æ“š
   - æ¯å€‹æ¨¡å‹çš„è©³ç´°æŒ‡æ¨™
   - æ¯é¡åˆ¥çš„ AP å€¼

3. **validation_{model_name}/** - å„æ¨¡å‹çš„è©³ç´°é©—è­‰çµæœ
   - æ¯å€‹æ¨¡å‹çš„ç¨ç«‹æŒ‡æ¨™æª”æ¡ˆ

### é©—è­‰å ±å‘Šç¯„ä¾‹
```
### Federated Learning Model Validation Summary ###

Model           mAP@0.5    mAP@0.75   mAP@0.5:0.95 Precision  Recall    
--------------------------------------------------------------------------------
baseline        0.752      0.543      0.481        0.743      0.687     
round_1         0.768      0.558      0.495        0.751      0.702     
round_2         0.784      0.572      0.508        0.762      0.718     

=== Performance Analysis ===
Baseline Model (baseline):
  mAP@0.5 = 0.752
  mAP@0.5:0.95 = 0.481

round_2:
  mAP@0.5 = 0.784 (Î” = +0.032, +4.3%)
  mAP@0.5:0.95 = 0.508 (Î” = +0.027, +5.6%)
```

# 8å€‹å®¢æˆ¶ç«¯ï¼Œé€²è¡Œ3è¼ªè¯é‚¦å­¸ç¿’ï¼Œç”Ÿæˆæ‰‹å‹•åŸ·è¡Œæ–‡æª”
```
./orchestrate.sh cityscapes 8 3 --manual > cityscapes_sop.sh
```

## ğŸ“ ç›®éŒ„çµæ§‹

### å°ˆæ¡ˆçµæ§‹
```
fl_yolo/
â”œâ”€â”€ README.md                          # æœ¬æ–‡æª”
â”œâ”€â”€ psudocode.txt                       # ç³»çµ±è¨­è¨ˆæ–‡æª”
â”œâ”€â”€ yolo9t2_ngc2306_20241226.sif        # Singularity å®¹å™¨æ˜ åƒæª”
â”œâ”€â”€ yolov9-c.pt                         # YOLOv9 é è¨“ç·´æ¬Šé‡
â”œâ”€â”€ src/                                # ä¸»è¦è…³æœ¬ç›®éŒ„
â”‚   â”œâ”€â”€ orchestrate.sh                  # ä¸»å”èª¿è…³æœ¬
â”‚   â”œâ”€â”€ data_prepare.py                 # è³‡æ–™åˆ†å‰²è…³æœ¬
â”‚   â”œâ”€â”€ fl_client_train.sh              # å®¢æˆ¶ç«¯æ‰¹æ¬¡è¨“ç·´èª¿åº¦å™¨
â”‚   â”œâ”€â”€ client_train.sh                 # å®¢æˆ¶ç«¯è¨“ç·´åŸ·è¡Œå™¨
â”‚   â”œâ”€â”€ client_train.sb                 # å®¢æˆ¶ç«¯ Slurm è…³æœ¬
â”‚   â”œâ”€â”€ fl_server_fedavg.sh             # è¯é‚¦å¹³å‡ä½œæ¥­èª¿åº¦å™¨
â”‚   â”œâ”€â”€ server_fedavg.py                # è¯é‚¦å¹³å‡æ¼”ç®—æ³•
â”‚   â”œâ”€â”€ server_fedavg.sb                # è¯é‚¦å¹³å‡ Slurm è…³æœ¬
â”‚   â””â”€â”€ validate_federated_model.py     # æ¨¡å‹é©—è­‰è…³æœ¬
â”œâ”€â”€ data/                               # è³‡æ–™é›†é…ç½®æª”
â”‚   â”œâ”€â”€ kitti.yaml
â”‚   â””â”€â”€ ...
â”œâ”€â”€ datasets/                           # åŸå§‹è³‡æ–™é›†
â”‚   â”œâ”€â”€ kitti/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ federated_data/                     # åˆ†å‰²å¾Œçš„å®¢æˆ¶ç«¯è³‡æ–™
â”‚   â””â”€â”€ kitti/
â”‚       â”œâ”€â”€ c1.yaml
â”‚       â”œâ”€â”€ c1/
â”‚       â”œâ”€â”€ c2.yaml
â”‚       â”œâ”€â”€ c2/
â”‚       â””â”€â”€ ...
â”œâ”€â”€ experiments/                        # å¯¦é©—çµæœ
â”‚   â””â”€â”€ {EXP_ID}/
â”‚       â”œâ”€â”€ orchestrator.log
â”‚       â”œâ”€â”€ slurm_logs/
â”‚       â”œâ”€â”€ client_outputs/
â”‚       â”œâ”€â”€ aggregated_weights/
â”‚       â””â”€â”€ fed_avg_logs/
â””â”€â”€ yolov9/                            # YOLOv9 åŸå§‹ç¢¼
```

### å¯¦é©—è¼¸å‡ºçµæ§‹
```
experiments/{EXP_ID}/
â”œâ”€â”€ orchestrator.log                    # ä¸»å”èª¿è…³æœ¬æ—¥èªŒ
â”œâ”€â”€ slurm_logs/                        # Slurm ä½œæ¥­æ—¥èªŒ
â”‚   â””â”€â”€ ...
â”œâ”€â”€ client_outputs/                    # å®¢æˆ¶ç«¯è¨“ç·´çµæœ
â”‚   â”œâ”€â”€ round_1/
â”‚   â”‚   â”œâ”€â”€ client_1/                  # YOLOv9 è¨“ç·´è¼¸å‡º
â”‚   â”‚   â”‚   â”œâ”€â”€ weights/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ best.pt           # æœ€ä½³æ¬Šé‡
â”‚   â”‚   â”‚   â”œâ”€â”€ results.csv           # è¨“ç·´æŒ‡æ¨™
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ round_2/
â”œâ”€â”€ aggregated_weights/                # è¯é‚¦å¹³å‡çµæœ
â”‚   â”œâ”€â”€ w_s_r1.pt                     # ç¬¬1è¼ªèšåˆæ¬Šé‡
â”‚   â”œâ”€â”€ w_s_r2.pt                     # ç¬¬2è¼ªèšåˆæ¬Šé‡
â”‚   â””â”€â”€ ...
â”œâ”€â”€ fed_avg_logs/                      # è¯é‚¦å¹³å‡æ—¥èªŒ
â”‚   â”œâ”€â”€ round_1.out
â”‚   â”œâ”€â”€ round_1.err
â”‚   â””â”€â”€ ...
â””â”€â”€ validation/                        # æ¨¡å‹é©—è­‰çµæœ (--val å•Ÿç”¨)
    â”œâ”€â”€ validation_summary.txt         # äººé¡å¯è®€æ‘˜è¦å ±å‘Š
    â”œâ”€â”€ model_comparison.json          # è©³ç´° JSON çµæœ
    â”œâ”€â”€ validation_baseline/           # åŸºç·šæ¨¡å‹é©—è­‰çµæœ
    â”‚   â””â”€â”€ baseline_metrics.json
    â”œâ”€â”€ validation_round_1/            # ç¬¬1è¼ªæ¨¡å‹é©—è­‰çµæœ
    â”‚   â””â”€â”€ round_1_metrics.json
    â””â”€â”€ validation_round_2/            # ç¬¬2è¼ªæ¨¡å‹é©—è­‰çµæœ
        â””â”€â”€ round_2_metrics.json
```

## ğŸ”§ è…³æœ¬èªªæ˜

### æ ¸å¿ƒè…³æœ¬

#### 1. `orchestrate.sh` - ä¸»å”èª¿è…³æœ¬
**åŠŸèƒ½**ï¼šçµ±ç±Œæ•´å€‹è¯é‚¦å­¸ç¿’æµç¨‹
**æ¨¡å¼**ï¼š
- è‡ªå‹•æ¨¡å¼ï¼šç›´æ¥åŸ·è¡Œå®Œæ•´æµç¨‹
- æ‰‹å‹•æ¨¡å¼ï¼šç”Ÿæˆ SOP æ–‡æª”

#### 2. `data_prepare.py` - è³‡æ–™åˆ†å‰²
**åŠŸèƒ½**ï¼šå°‡è³‡æ–™é›†åˆ†å‰²ç‚ºå¤šå€‹å®¢æˆ¶ç«¯å­é›†
**ç‰¹é»**ï¼š
- è‡ªå‹•æª¢æ¸¬å·²åˆ†å‰²çš„è³‡æ–™é›†
- ä½¿ç”¨ç¬¦è™Ÿé€£çµç¯€çœç©ºé–“
- ç”Ÿæˆå®¢æˆ¶ç«¯å°ˆç”¨é…ç½®æª”

#### 3. `fl_client_train.sh` - å®¢æˆ¶ç«¯èª¿åº¦å™¨
**åŠŸèƒ½**ï¼šæ‰¹æ¬¡æäº¤æ‰€æœ‰å®¢æˆ¶ç«¯çš„è¨“ç·´ä½œæ¥­
**ç‰¹é»**ï¼š
- ä¸¦è¡Œæäº¤å¤šå€‹ Slurm ä½œæ¥­
- è‡ªå‹•ç”Ÿæˆ Wandb å°ˆæ¡ˆå’Œé‹è¡Œåç¨±
- è™•ç†æ¬Šé‡æª”æ¡ˆè·¯å¾‘é‚è¼¯

#### 4. `server_fedavg.py` - è¯é‚¦å¹³å‡
**åŠŸèƒ½**ï¼šèšåˆå¤šå€‹å®¢æˆ¶ç«¯çš„æ¨¡å‹æ¬Šé‡
**æ¼”ç®—æ³•**ï¼šæ¨™æº–è¯é‚¦å¹³å‡ (FedAvg)
```python
w_global = (1/K) * Î£(w_k)  # Kç‚ºå®¢æˆ¶ç«¯æ•¸é‡
```

#### 5. `validate_federated_model.py` - æ¨¡å‹é©—è­‰
**åŠŸèƒ½**ï¼šé©—è­‰è¯é‚¦å­¸ç¿’æ¨¡å‹æ•ˆèƒ½
**ç‰¹é»**ï¼š
- è‡ªå‹•ç™¼ç¾å¯¦é©—ä¸­çš„æ‰€æœ‰æ¨¡å‹ï¼ˆåŸºç·š + å„è¼ªæ¬¡ï¼‰
- ä½¿ç”¨ YOLOv9 æ ¸å¿ƒçµ„ä»¶é€²è¡Œé©—è­‰
- ç”Ÿæˆè©³ç´°çš„æŒ‡æ¨™åˆ†æå’Œæ¯”è¼ƒå ±å‘Š
- åŒ…å«è³‡æ–™é›†é¡åˆ¥åˆ†å¸ƒåˆ†æ

**è¼¸å‡º**ï¼š
- æ•´é«”æŒ‡æ¨™æ¯”è¼ƒï¼ˆmAP@0.5ã€mAP@0.5:0.95ã€ç²¾åº¦ã€å¬å›ç‡ï¼‰
- æ¯é¡åˆ¥ AP åˆ†æè¡¨
- æ•ˆèƒ½æ”¹å–„åˆ†æï¼ˆç›¸å°æ–¼åŸºç·šçš„æå‡å¹…åº¦ï¼‰
- JSON æ ¼å¼çš„è©³ç´°çµæœæ•¸æ“š

### è¼”åŠ©è…³æœ¬

#### `client_train.sh` - å–®ä¸€å®¢æˆ¶ç«¯è¨“ç·´
**åŠŸèƒ½**ï¼šåŸ·è¡Œå–®å€‹å®¢æˆ¶ç«¯çš„ YOLOv9 è¨“ç·´
**ç‰¹é»**ï¼šåƒæ•¸åŒ–è¨­è¨ˆï¼Œæ”¯æ´ä¸åŒé…ç½®

#### Slurm è…³æœ¬ (`.sb`)
**åŠŸèƒ½**ï¼šå®šç¾© Slurm ä½œæ¥­çš„è³‡æºéœ€æ±‚å’ŒåŸ·è¡Œç’°å¢ƒ
**ç‰¹é»**ï¼šGPU åˆ†é…ã€è¨˜æ†¶é«”ç®¡ç†ã€å®¹å™¨åŸ·è¡Œ

## ğŸ†” å¯¦é©—ç®¡ç†

### å¯¦é©— ID æ ¼å¼
```
{RUN_NUM}_{DATASET}_{CLIENT_NUM}C_{TOTAL_ROUNDS}R_{TIMESTAMP}_{MODE}
```

### ç¯„ä¾‹
```
1_kitti_4C_5R_202508051830_manual
â”‚ â”‚     â”‚  â”‚ â”‚              â”‚
â”‚ â”‚     â”‚  â”‚ â”‚              â””â”€ æ¨¡å¼ (manual/auto)
â”‚ â”‚     â”‚  â”‚ â””â”€ æ™‚é–“æˆ³ (YYYYMMDDHHMM)
â”‚ â”‚     â”‚  â””â”€ è¼ªæ¬¡æ•¸
â”‚ â”‚     â””â”€ å®¢æˆ¶ç«¯æ•¸é‡
â”‚ â””â”€ è³‡æ–™é›†åç¨±
â””â”€ å¯¦é©—ç·¨è™Ÿ
```

### Wandb æ•´åˆ
- **å°ˆæ¡ˆåç¨±**ï¼šå»é™¤æ™‚é–“æˆ³å’Œæ¨¡å¼çš„ç°¡åŒ– ID
- **é‹è¡Œåç¨±**ï¼š`{ç°¡åŒ–ID}_c{å®¢æˆ¶ç«¯}_r{è¼ªæ¬¡}`
- **ç¯„ä¾‹**ï¼š
  - å°ˆæ¡ˆï¼š`1_kitti_4C_5R`
  - é‹è¡Œï¼š`1_kitti_4C_5R_c1_r1`, `1_kitti_4C_5R_c2_r1`

## ğŸ” ç›£æ§èˆ‡é™¤éŒ¯

### Slurm ä½œæ¥­ç›£æ§
```bash
# æŸ¥çœ‹ç•¶å‰ä½œæ¥­ç‹€æ…‹
squeue -u $USER

# æŸ¥çœ‹ç‰¹å®šä½œæ¥­è©³æƒ…
scontrol show job <JOB_ID>

# å–æ¶ˆä½œæ¥­
scancel <JOB_ID>
```

### æ—¥èªŒæª¢æŸ¥
```bash
# æŸ¥çœ‹ä¸»å”èª¿è…³æœ¬æ—¥èªŒ
tail -f experiments/{EXP_ID}/orchestrator.log

# æŸ¥çœ‹å®¢æˆ¶ç«¯è¨“ç·´æ—¥èªŒ
tail -f experiments/{EXP_ID}/slurm_logs/client_1_round_1.out

# æŸ¥çœ‹è¯é‚¦å¹³å‡æ—¥èªŒ
tail -f experiments/{EXP_ID}/fed_avg_logs/round_1.out
```

### å¸¸è¦‹å•é¡Œæª¢æŸ¥
```bash
# æª¢æŸ¥è³‡æ–™é›†æ˜¯å¦æº–å‚™å°±ç·’
ls -la federated_data/{DATASET_NAME}/

# æª¢æŸ¥æ¬Šé‡æª”æ¡ˆ
ls -la experiments/{EXP_ID}/aggregated_weights/

# æª¢æŸ¥å®¢æˆ¶ç«¯è¼¸å‡º
ls -la experiments/{EXP_ID}/client_outputs/round_1/client_*/weights/
```

## ğŸš¨ æ•…éšœæ’é™¤

### ç’°å¢ƒè®Šæ•¸è¨­å®š
åŸ·è¡Œä»»ä½•è…³æœ¬å‰ï¼Œè«‹ç¢ºä¿è¨­å®šå¿…è¦çš„ç’°å¢ƒè®Šæ•¸ï¼š
```bash
export EXP_ID=<å¯¦é©—ID>
export WROOT=<å°ˆæ¡ˆæ ¹ç›®éŒ„çµ•å°è·¯å¾‘>
export DATASET_NAME=<è³‡æ–™é›†åç¨±>
export CLIENT_NUM=<å®¢æˆ¶ç«¯æ•¸é‡>
```

### å¸¸è¦‹éŒ¯èª¤è§£æ±º

#### 1. ç’°å¢ƒè®Šæ•¸æœªè¨­å®š
**éŒ¯èª¤è¨Šæ¯**ï¼š`Error: WROOT environment variable is not set`
**è§£æ±ºæ–¹æ¡ˆ**ï¼šåœ¨åŸ·è¡Œä»»ä½•è…³æœ¬å‰è¨­å®šç’°å¢ƒè®Šæ•¸
```bash
# ç¢ºä¿ WROOT ç’°å¢ƒè®Šæ•¸æ­£ç¢ºè¨­å®š
echo $WROOT
```

#### 2. Singularity æ˜ åƒæª”è·¯å¾‘éŒ¯èª¤
**éŒ¯èª¤è¨Šæ¯**ï¼š`Error: Singularity image not found`
**è§£æ±ºæ–¹æ¡ˆ**ï¼š
```bash
# ç¢ºä¿ singularity æª”å­˜åœ¨
ls -la ${WROOT}/yolo9t2_ngc2306_20241226.sif
```

####  3. æ‰‹å‹•æ¨¡å¼ + é™¤éŒ¯
```bash
# ç”Ÿæˆ SOP å¾Œé€æ­¥åŸ·è¡Œ
./orchestrate.sh kitti 4 2 --manual > debug_sop.sh
bash -x debug_sop.sh  # é€è¡Œé¡¯ç¤ºåŸ·è¡Œéç¨‹
```

#### å–®ç¨æ¸¬è©¦çµ„ä»¶
<!-- ```bash
# æ¸¬è©¦è³‡æ–™æº–å‚™
python3 src/data_prepare.py --dataset-name kitti --num-clients 4

# æ¸¬è©¦å–®ä¸€å®¢æˆ¶ç«¯è¨“ç·´
./src/client_train.sh --data-yaml federated_data/kitti/c1.yaml \
                      --weights-in yolov9-c.pt \
                      --project-out /tmp/test \
                      --name-out test_run

# æ¸¬è©¦è¯é‚¦å¹³å‡
python3 src/server_fedavg.py --input-dir /path/to/client_outputs \
                              --output-file /tmp/aggregated.pt \
                              --expected-clients 4
``` -->

---

**æœ€å¾Œæ›´æ–°**ï¼š2025-08-05  
**ç‰ˆæœ¬**ï¼šv1.0  
**ç¶­è­·è€…**ï¼š[nchc/waue0920]
